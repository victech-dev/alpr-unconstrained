(function(t){function e(e){for(var n,o,r=e[0],l=e[1],u=e[2],c=0,f=[];c<r.length;c++)o=r[c],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&f.push(s[o][0]),s[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);h&&h(e);while(f.length)f.shift()();return a.push.apply(a,u||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,r=1;r<i.length;r++){var l=i[r];0!==s[l]&&(n=!1)}n&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},s={app:0},a=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var h=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("85ec"),s=i.n(n);s.a},"1a5c":function(t,e,i){},"233b":function(t,e,i){t.exports=i.p+"img/sample.5ca5980d.png"},4157:function(t,e,i){"use strict";var n=i("cbb2"),s=i.n(n);s.a},4270:function(t,e,i){"use strict";var n=i("1a5c"),s=i.n(n);s.a},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},a=[],o={name:"App",components:{}},r=o,l=(i("034f"),i("2877")),u=Object(l["a"])(r,s,a,!1,null,null,null),h=u.exports,c=i("8c4f"),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"annotool"},[i("div",[i("button",{staticClass:"pure-button",on:{click:t.onStart}},[t._v("Start")]),t._v("-- "),i("button",{staticClass:"pure-button",on:{click:t.onSubmit}},[t._v("Submit")]),t._v("-- "+t._s(t.submitResult)+" ")]),i("h5",[t._v(" file : "+t._s(null===t.annoData?"none":t.annoData.file)+", wh=("+t._s(null===t.image?0:t.image.width)+", "+t._s(null===t.image?0:t.image.height)+") ")]),i("canvas",{attrs:{id:"imgCanvas",tabindex:"0",width:t.width,height:t.height},on:{keydown:t.onKeyDown,mousedown:t.onMouseDown,mouseup:t.onMouseUp,click:t.onMouseClick,dblclick:t.onMouseDbClick}})])},p=[],v=(i("c975"),i("d81d"),i("13d5"),i("a434"),i("d3b7"),i("25f0"),i("b85c")),b=(i("96cf"),i("1da1")),d=i("d4ec"),g=i("bee2");function m(t,e,i){return t<=e?e:t>=i?i:t}function y(t){return new Promise((function(e){var i=new Image;i.onload=function(){return e(i)},i.src=t}))}var w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(d["a"])(this,t),this.x=e,this.y=i}return Object(g["a"])(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"fromXY",value:function(e,i){return new t(e,i)}},{key:"move",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"copy",value:function(){return new t(this.x,this.y)}},{key:"sqrdist",value:function(t){return Math.pow(Math.abs(t.x-this.x),2)+Math.pow(Math.abs(t.y-this.y),2)}},{key:"dist",value:function(t){return Math.sqrt(this.sqrdist(t))}},{key:"getJson",value:function(t,e){return{x:m(this.x/t,0,1,0),y:m(this.y/e,0,1)}}}]),t}(),x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w;Object(d["a"])(this,t),this.pt0=e,this.pt1=i,this.pt2=n,this.pt3=s}return Object(g["a"])(t,[{key:"setByPts",value:function(t,e,i,n){return this.pt0=t,this.pt1=e,this.pt2=i,this.pt3=n,this}},{key:"setByValues",value:function(t,e,i,n,s,a,o,r){return this.pt0.set(t,e),this.pt1.set(i,n),this.pt2.set(s,a),this.pt3.set(o,r),this}},{key:"copy",value:function(){return new t(this.pt0.copy(),this.pt1.copy(),this.pt2.copy(),this.pt3.copy())}},{key:"pts",value:function(){return[this.pt0,this.pt1,this.pt2,this.pt3]}},{key:"pt",value:function(t){return 0==t?this.pt0:1==t?this.pt1:2==t?this.pt2:3==t?this.pt3:null}},{key:"getBb",value:function(){var t=Math.min.apply(Math,this.pts().map((function(t){return t.x}))),e=Math.max.apply(Math,this.pts().map((function(t){return t.x}))),i=Math.min.apply(Math,this.pts().map((function(t){return t.y}))),n=Math.max.apply(Math,this.pts().map((function(t){return t.y})));return[t,e,i,n]}},{key:"move",value:function(t,e){return this.pts().map((function(i){i.x+=t,i.y+=e})),this}},{key:"fineNearest",value:function(t){return this.pts().map((function(t,e){return[t,e]})).reduce((function(e,i){return t.sqrdist(e[0])<t.sqrdist(i[0])?e:i}))}},{key:"include",value:function(t){for(var e=this.pts(),i=!1,n=0,s=e.length-1;n<e.length;s=n++){var a=e[n].x,o=e[n].y,r=e[s].x,l=e[s].y,u=o>t.y!=l>t.y&&t.x<(r-a)*(t.y-o)/(l-o)+a;u&&(i=!i)}return i}},{key:"getJson",value:function(t,e){return[this.pt0.getJson(t,e),this.pt1.getJson(t,e),this.pt2.getJson(t,e),this.pt3.getJson(t,e)]}}]),t}(),_={created:function(){},mounted:function(){console.log("mounted");var t=document.getElementById("imgCanvas");this.canvas=t.getContext("2d"),this.canvas.imageSmoothingEnabled=!1},data:function(){return{annoData:[],canvas:null,width:500,height:500,image:null,scale:1,viewRect:{l:0,t:0,w:500,h:500},labels:[],curLabel:null,isMouseProcessing:!1,mx:0,my:0,isLabelCreating:!1,creatingLabel:[],submitResult:""}},methods:{handleNewData:function(){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.labels=[],e.next=3,y(t.annoData.file);case 3:i=e.sent,t.image=i,t.createLabels(),t.setViewRect(0,0,i.width,i.height),t.updateView();case 8:case"end":return e.stop()}}),e)})))()},createLabels:function(){var t,e=this.image.width,i=this.image.height,n=Object(v["a"])(this.annoData.labels);try{for(n.s();!(t=n.n()).done;){var s=t.value;if(4==s.length){for(var a=[],o=0;o<s.length;++o)a.push(new w(s[o].x*e,s[o].y*i));this.labels.push(new x(a[0],a[1],a[2],a[3]))}}}catch(r){n.e(r)}finally{n.f()}},onStart:function(){var t=this;this.$http.get("/annos").then((function(e){t.annoData=e.data,t.scale=1,t.curLabel=null,t.handleNewData()}))},getLabelsJson:function(){var t,e=[],i=Object(v["a"])(this.labels);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.push(n.getJson(this.image.width,this.image.height))}}catch(s){i.e(s)}finally{i.f()}return e},onSubmit:function(){if(!0!==this.isLabelCreating&&!0!==this.isMouseProcessing)if(0!==this.labels.length){var t={file:this.annoData.file,labels:this.getLabelsJson()},e=this;this.$http.post("/annos",t).then((function(t){console.log(t),e.showSubmitResult(t.status)})).catch((function(t){console.log(t.response),e.showSubmitResult(t.response.status)}))}else alert("No label data!");else alert("Cannot now!")},showSubmitResult:function(t){var e=this;this.submitResult=200===t?"Success":404===t?"Fail (Already submitted)":"Fail (code="+t.toString()+")",setTimeout((function(){e.submitResult=""}),5e3)},toImageCoord:function(t,e){var i=this.viewRect,n=t/this.width*i.w+i.l,s=e/this.height*i.h+i.t;return new w(n,s)},fromImageCoord:function(t,e){var i=this.viewRect,n=(t-i.l)*this.width/i.w,s=(e-i.t)*this.height/i.h;return new w(n,s)},onMouseDown:function(t){this.mx=t.offsetX,this.my=t.offsetY,this.isMouseProcessing=!0},onMouseUp:function(t){if(!0===this.isMouseProcessing&&(this.isMouseProcessing=!1,Math.abs(this.mx-t.offsetX)>=10&&Math.abs(this.my-t.offsetY)>=10)){var e=Math.min(this.mx,t.offsetX),i=Math.max(this.mx,t.offsetX),n=Math.min(this.my,t.offsetY),s=Math.max(this.my,t.offsetY),a=this.toImageCoord(e,n),o=this.toImageCoord(i,s);this.setViewRect(a.x,a.y,o.x-a.x,o.y-a.y),this.scale=this.image.width/(o.x-a.x),this.updateView()}},onMouseClick:function(t){var e=this.toImageCoord(t.offsetX,t.offsetY);if(!0===this.isLabelCreating){var i=this.creatingLabel;return i.push(e),4==this.creatingLabel.length&&(this.labels.push(new x(i[0],i[1],i[2],i[3])),this.isLabelCreating=!1,this.creatingLabel=[]),void this.updateView()}if(null==this.curLabel);else{var n=this.curLabel.fineNearest(e);n[0].dist(e)<100&&(n[0].set(e.x,e.y),this.updateView())}},onMouseDbClick:function(t){var e=this.toImageCoord(t.offsetX,t.offsetY);if(!0!==this.isLabelCreating){if(null!=this.curLabel)return this.curLabel=null,void this.updateView();if(this.labels.length>0){this.curLabel=null;for(var i=0;i<this.labels.length;i++)if(1==this.labels[i].include(e)){this.curLabel=this.labels[i];break}this.updateView()}else;}},onKeyDown:function(t){if(!0===this.isMouseProcessng&&"Escape"==t.key&&this.isMouseProcessing&&(this.isMouseProcessing=!1),!0===this.isLabelCreating&&"Escape"==t.key&&(this.isLabelCreating=!1,this.creatingLabel=[],this.updateView()),null!=this.curLabel&&"Escape"==t.key&&(this.curLabel=null,this.updateView()),"s"==t.key&&1==t.ctrlKey&&(this.scale-=t.altKey?.1:.5,this.updateView()),"`"==t.key&&(this.scale=1,this.setViewRect(0,0,this.image.width,this.image.height),this.updateView()),"c"==t.key&&(this.isLabelCreating=!0,this.creatingLabel=[]),"d"==t.key&&null!=this.curLabel){var e=this.labels.indexOf(this.curLabel);e>=0&&(this.labels.splice(e,1),this.updateView())}},drawLabel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blue";4==t.length&&t.push(t[0].copy());var n=this;t=t.map((function(t){return n.fromImageCoord(t.x,t.y)}));var s=this.canvas;s.lineWidth="1",s.strokeStyle=e,s.beginPath(),s.moveTo(t[0].x,t[0].y);for(var a=1;a<t.length;a++)s.lineTo(t[a].x,t[a].y);s.stroke(),s.fillStyle=i,s.fillRect(t[0].x-2,t[0].y-2,4,4)},updateView:function(){var t=this;if(null!==this.canvas&&null!==this.image){var e=this.viewRect;this.width=e.w*this.scale,this.height=e.h*this.scale,this.$nextTick((function(){t.canvas.drawImage(t.image,e.l,e.t,e.w,e.h,0,0,t.width,t.height);var i,n=Object(v["a"])(t.labels);try{for(n.s();!(i=n.n()).done;){var s=i.value,a=s===t.curLabel?"yellow":"red";t.drawLabel(s.pts(),a)}}catch(o){n.e(o)}finally{n.f()}t.isLabelCreating&&t.drawLabel(t.creatingLabel)}))}},setViewRect:function(t,e,i,n){this.viewRect.l=t,this.viewRect.t=e,this.viewRect.w=i,this.viewRect.h=n}}},k=_,M=(i("4270"),Object(l["a"])(k,f,p,!1,null,"1c750bcc",null)),L=M.exports,C=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},O=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"help"},[n("h4",[t._v("** Start 버튼 **")]),n("ul",[n("li",[t._v("새로 편집할 데이터를 불러옵니다.")])]),n("h4",[t._v("** Submit 버튼 **")]),n("ul",[n("li",[t._v("편집한 결과를 전송합니다. 한 번 submit 되면 다시 submit 불가")]),n("li",[t._v("혹시 잘못된 결과를 submit 했으면 저에게 file 명을 알려주세요")])]),n("h4",[t._v("** 편집 방법 **")]),n("ul",[n("li",[t._v("이미 적당한 label들이 존재하고, 요 점들을 적절히 옮겨주시면 됩니다.")]),n("li",[t._v("left-top이 첫번째 점(파란 점)이 되어야 하고 시계 방향 순서입니다.")]),n("li",[t._v("번호판의 전체 (글자 + 외곽)이 적당히 포함되도록 해주세요")])]),n("img",{attrs:{src:i("233b")}}),n("h4",[t._v("** 조작 방법 **")]),n("ul",[n("li",[n("b",[t._v("화면 확대")]),t._v(" : 마우스로 적당히 드래그앤드랍")]),n("li",[n("b",[t._v("화면 확대 취소")]),t._v(" : '`' 키. (1 왼쪽의 backquote 키)")]),n("li",[n("b",[t._v("label 선택")]),t._v(" : label 안쪽 영역을 더블클릭. 선택되면 색이 노란색으로 바뀝니다.")]),n("li",[n("b",[t._v("label 선택취소")]),t._v("Esc 키 혹은 다시 더블클릭")]),n("li",[n("b",[t._v("점 옮기기")]),t._v(" : 선택된 상태에서 클릭하면 현재 가장 가까운 점이 클릭한 위치로 올겨집니다.")]),n("li",[n("b",[t._v("label 추가")]),t._v(" : 미선택 상태에서 c 키를 누르고 네 점을 클릭")]),n("li",[n("b",[t._v("label 삭제")]),t._v(" : 선택 상태에서 d 키")])])])}],R={name:"Help",props:{msg:String}},S=R,j=(i("4157"),Object(l["a"])(S,C,O,!1,null,"4e285d30",null)),P=j.exports;n["a"].use(c["a"]);var V=new c["a"]({mode:"history",routes:[{path:"/",name:"annotool",component:L},{path:"/help",name:"help",component:P}]}),D=i("bc3a"),J=i.n(D);n["a"].config.productionTip=!1,n["a"].prototype.$http=J.a,new n["a"]({render:function(t){return t(h)},router:V}).$mount("#app")},"85ec":function(t,e,i){},cbb2:function(t,e,i){}});
//# sourceMappingURL=app.125293aa.js.map